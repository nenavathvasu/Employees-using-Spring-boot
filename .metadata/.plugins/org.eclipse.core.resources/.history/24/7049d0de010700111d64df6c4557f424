package com.sathya.controller;

import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.hateoas.EntityModel;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import com.sathya.Model.Employee;
import com.sathya.Service.EmployeeService;

import static org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.*;

@RestController
@RequestMapping("/employees")
public class EmployeeController {

    @Autowired
    private EmployeeService service;

    // ================= SAVE =================

    @PostMapping("/save")
    public ResponseEntity<Employee> saveEmployee(@RequestBody Employee emp) {
        Employee saved = service.saveEmployee(emp);

        return ResponseEntity.status(HttpStatus.CREATED)
                .header("message", "Employee saved successfully")
                .body(saved);
    }

    @PostMapping("/saveAll")
    public ResponseEntity<List<Employee>> saveAll(@RequestBody List<Employee> emp) {
        List<Employee> savedList = service.SaveAllEmployee(emp);

        return ResponseEntity.status(HttpStatus.CREATED)
                .header("message", "All employees saved successfully")
                .body(savedList);
    }

    // ================= GET BY ID (HATEOAS) =================

    @GetMapping("/{id}")
    public ResponseEntity<EntityModel<Employee>> getEmployeeByIdHateoas(@PathVariable Long id) {

        Employee employee = service.getEmployeeById(id);

        EntityModel<Employee> model = EntityModel.of(employee);
        model.add(linkTo(methodOn(EmployeeController.class)
                .getEmployeeByIdHateoas(id)).withSelfRel());
        model.add(linkTo(methodOn(EmployeeController.class)
                .deleteEmployeeById(id)).withRel("delete"));
        model.add(linkTo(methodOn(EmployeeController.class)
                .updateEmployee(id, employee)).withRel("update"));
        model.add(linkTo(methodOn(EmployeeController.class)
                .getAllEmp()).withRel("getAll"));

        return ResponseEntity.ok()
                .header("message", "Employee fetched successfully")
                .body(model);
    }

    // ================= GET ALL =================

    @GetMapping
    public ResponseEntity<List<Employee>> getAllEmp() {
        List<Employee> employees = service.getAllEmployees();

        return ResponseEntity.ok()
                .header("message", "All employees retrieved")
                .body(employees);
    }

    
    //delete employees by id 
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteEmployeeById(@PathVariable Long id) {
        service.deleteEmployeeById(id);

        return ResponseEntity.status(HttpStatus.NO_CONTENT)
                .header("message", "Employee deleted successfully")
                .build();
    }

    //delete all employees
    @DeleteMapping
    public ResponseEntity<Void> deleteAllEmployees() {
        service.deleteAllEmployees();

        return ResponseEntity.status(HttpStatus.NO_CONTENT)
                .header("message", "All employees deleted")
                .build();
    }

    // ================= UPDATE =================

    @PutMapping("/{id}")
    public ResponseEntity<Employee> updateEmployee(
            @PathVariable Long id,
            @RequestBody Employee employee) {

        Employee updated = service.updateEmployee(id, employee);

        return ResponseEntity.ok()
                .header("message", "Employee updated successfully")
                .body(updated);
    }

    @PatchMapping("/{id}")
    public ResponseEntity<Employee> partialUpdate(
            @PathVariable Long id,
            @RequestBody Map<String, Object> updates) {

        Employee updated = service.partialUpdate(id, updates);

        return ResponseEntity.ok()
                .header("message", "Employee partially updated")
                .body(updated);
    }

    // ================= SALARY FILTERS =================

    @GetMapping("/minsalary")
    public ResponseEntity<List<Employee>> minSalary(@RequestParam double minsalary) {

        return ResponseEntity.ok()
                .header("message", "Employees with salary >= " + minsalary)
                .body(service.getMinSalary(minsalary));
    }

    @GetMapping("/maxsalary")
    public ResponseEntity<List<Employee>> maxSalary(@RequestParam double maxsalary) {

        return ResponseEntity.ok()
                .header("message", "Employees with salary <= " + maxsalary)
                .body(service.getMaxSalary(maxsalary));
    }

    @GetMapping("/salarybetween")
    public ResponseEntity<List<Employee>> salaryBetween(
            @RequestParam double min,
            @RequestParam double max) {

        return ResponseEntity.ok()
                .header("message", "Employees with salary between range")
                .body(service.getSalaryBetween(min, max));
    }

    // ================= EMAIL =================

    @GetMapping("/email")
    public ResponseEntity<Employee> getByEmail(@RequestParam String email) {

        return ResponseEntity.ok()
                .header("message", "Employee fetched by email")
                .body(service.getByEmail(email));
    }

    // ================= GENDER & SALARY =================

    @GetMapping("/salary-or-gender")
    public ResponseEntity<List<Employee>> salaryOrGender(
            @RequestParam double salary,
            @RequestParam String gender) {

        return ResponseEntity.ok()
                .header("message", "Filtered by salary OR gender")
                .body(service.getSalaryGreaterOrGender(salary, gender));
    }

    @GetMapping("/gender-and-salary")
    public ResponseEntity<List<Employee>> genderAndSalary(
            @RequestParam String gender,
            @RequestParam double minSalary) {

        return ResponseEntity.ok()
                .header("message", "Filtered by gender AND salary")
                .body(service.getGenderAndMinSalary(gender, minSalary));
    }

    @GetMapping("/gender-or-salary-between")
    public ResponseEntity<List<Employee>> genderOrSalaryBetween(
            @RequestParam String gender,
            @RequestParam double min,
            @RequestParam double max) {

        return ResponseEntity.ok()
                .header("message", "Filtered by gender OR salary range")
                .body(service.getGenderOrSalaryBetween(gender, min, max));
    }

    // ================= SORTING =================

    @GetMapping("/salary-asc")
    public ResponseEntity<List<Employee>> salaryAsc() {
        return ResponseEntity.ok()
                .header("message", "Employees sorted by salary ascending")
                .body(service.getSalaryAsc());
    }

    @GetMapping("/salary-desc")
    public ResponseEntity<List<Employee>> salaryDesc() {
        return ResponseEntity.ok()
                .header("message", "Employees sorted by salary descending")
                .body(service.getSalaryDesc());
    }

    // ================= NAME =================

    @GetMapping("/name-ignorecase")
    public ResponseEntity<List<Employee>> nameIgnoreCase(@RequestParam String name) {

        return ResponseEntity.ok()
                .header("message", "Employees fetched ignoring case")
                .body(service.getByNameIgnoreCase(name));
    }

    @GetMapping("/name-contains")
    public ResponseEntity<List<Employee>> nameContains(@RequestParam String keyword) {

        return ResponseEntity.ok()
                .header("message", "Employees with name containing keyword")
                .body(service.getByNameContaining(keyword));
    }
    
    
    
    
    
    
    public ResponseEntity<List<Employee>> filterEmployees(@RequestParam String dept,
                                                          @RequestParam String gender,
                                                          @RequestParam double minSalary,
                                                          @RequestParam double maxSalary) 
    {
        List<Employee> employees = service.getEmployees(dept, gender, minSalary, maxSalary);

        return ResponseEntity.ok(employees);
    }
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
}
